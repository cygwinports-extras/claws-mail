--- origsrc/claws-mail-3.5.0/claws-mail.pc.in	2008-06-27 02:40:27.000000000 -0500
+++ src/claws-mail-3.5.0/claws-mail.pc.in	2008-07-08 14:35:36.296875000 -0500
@@ -10,5 +10,5 @@
 Name: Claws Mail
 Description: Claws Mail
 Version: @MAJOR_VERSION@.@MINOR_VERSION@.@MICRO_VERSION@.@EXTRA_VERSION@
-
+Libs: -L${libdir} @CLAWS_IMPLIB@
 Cflags: @ASPELL_CFLAGS@ @GPGME_CFLAGS@ @OPENSSL_CFLAGS@ -I${pkgincludedir} -I${pkgincludedir}/common -I${pkgincludedir}/gtk
--- origsrc/claws-mail-3.5.0/configure.ac	2008-06-27 02:49:55.000000000 -0500
+++ src/claws-mail-3.5.0/configure.ac	2008-07-08 14:35:36.312500000 -0500
@@ -101,15 +101,22 @@
 dnl Copied from the official gtk+-2 configure.in
 AC_MSG_CHECKING([for some Win32 platform])
 case "$host" in
-  *-*-mingw*|*-*-cygwin*)
+  *-*-cygwin*)
+    platform_win32=yes
+    CLAWS_IMPLIB="-lclaws-mail"
+    ;;
+  *-*-mingw*)
     platform_win32=yes
     LDFLAGS="$LDFLAGS -mwindows"
+    CLAWS_IMPLIB="-lclaws-mail"
     ;;
   *)
     platform_win32=no
+    CLAWS_IMPLIB=
     ;;
 esac
 AC_MSG_RESULT([$platform_win32])
+AC_SUBST(CLAWS_IMPLIB)
 AM_CONDITIONAL(PLATFORM_WIN32, test x"$platform_win32" = x"yes")
 
 AC_MSG_CHECKING([for native Win32])
--- origsrc/claws-mail-3.5.0/src/Makefile.am	2008-06-27 02:40:22.000000000 -0500
+++ src/claws-mail-3.5.0/src/Makefile.am	2008-07-08 16:29:56.187500000 -0500
@@ -12,9 +12,13 @@
 bin_PROGRAMS = claws-mail
 install-exec-hook:
 	@rm -f $(DESTDIR)$(bindir)/sylpheed-claws
-	@ln -s claws-mail $(DESTDIR)$(bindir)/sylpheed-claws
-
+	@ln -s claws-mail$(EXEEXT) $(DESTDIR)$(bindir)/sylpheed-claws
 if PLATFORM_WIN32
+	$(mkinstalldirs) $(DESTDIR)$(libdir)
+	$(INSTALL_DATA) libclaws-mail.a $(DESTDIR)$(libdir)/libclaws-mail.a
+endif
+
+if OS_WIN32
 LTRCCOMPILE = $(LIBTOOL) --mode=compile $(RC) \
      `echo $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) | \
      sed -e 's/-I/--include-dir /g;s/-D/--define /g'`
@@ -498,7 +502,7 @@
 	-I$(srcdir)/etpan
 
 if PLATFORM_WIN32
-arch_ldflags := -export-all-symbols
+arch_ldflags := -Wl,--export-all-symbols,--out-implib,libclaws-mail.a
 else
 arch_ldflags :=
 endif
@@ -560,20 +564,3 @@
 #to call inside gpgme due to our lack of LARGEFILE support
 
 AM_YFLAGS = -d
-
-if CYGWIN
-claws-mail$(EXEEXT): $(claws_mail_OBJECTS) $(claws_mail_DEPENDENCIES) 
-	@rm -f claws-mail$(EXEEXT)
-	@rm -f claws-mail.def claws-mail.base claws-mail.exp libclaws-mail.a .libs/libclaws-mail.a
-	$(LINK) -shared $(claws_mailLDFLAGS) -Wl,--out-implib=libclaws-mail.a -Wl,--export-all-symbols,--exclude-symbols,main $(claws_mail_OBJECTS) -Wl,--no-whole-archive $(claws_mail_LDADD) $(LIBS)
-	dlltool --output-def claws-mail.def --dllname claws-mail$(EXEEXT) --export-all-symbols --exclude-symbols main $(claws_mail_OBJECTS) gtk/.libs/libclawsgtk.a
-	$(LINK) $(claws_mail_LDFLAGS) -Wl,--base-file,claws-mail.base $(claws_mail_OBJECTS) $(claws_mail_LDADD) $(LIBS)
-	sleep 5
-	dlltool --base-file claws-mail.base --input-def claws-mail.def --output-exp claws-mail.exp
-	$(LINK) $(claws_mail_LDFLAGS) -Wl,claws-mail.exp $(claws_mail_OBJECTS) $(claws_mail_LDADD) $(LIBS)
-	@cp libclaws-mail.a .libs/libclaws-mail.a
-else
-#claws-mail$(EXEEXT): $(claws_mail_OBJECTS) $(claws_mail_DEPENDENCIES) 
-#	@rm -f claws-mail$(EXEEXT)
-#	$(LINK) $(claws_mail_LDFLAGS) $(claws_mail_OBJECTS) $(claws_mail_LDADD) $(LIBS)
-endif
--- origsrc/claws-mail-3.5.0/src/plugins/bogofilter/Makefile.am	2008-06-27 02:40:24.000000000 -0500
+++ src/claws-mail-3.5.0/src/plugins/bogofilter/Makefile.am	2008-07-08 14:35:36.343750000 -0500
@@ -6,14 +6,17 @@
 	bogofilter.c bogofilter.h \
 	bogofilter_gtk.c 
 
-bogofilter_la_LDFLAGS = \
-	-avoid-version -module
-
 if CYGWIN
 cygwin_export_lib = -L$(top_builddir)/src -lclaws-mail
+no_undefined = -no-undefined
 else
 cygwin_export_lib =
+no_undefined =
 endif
+
+bogofilter_la_LDFLAGS = \
+	-avoid-version -module $(no_undefined)
+
 bogofilter_la_LIBADD = $(cygwin_export_lib) \
 	$(GTK_LIBS)	\
 	$(OPENSSL_LIBS) \
--- origsrc/claws-mail-3.5.0/src/plugins/demo/Makefile.am	2008-06-27 02:40:24.000000000 -0500
+++ src/claws-mail-3.5.0/src/plugins/demo/Makefile.am	2008-07-08 14:35:36.359375000 -0500
@@ -5,15 +5,17 @@
 demo_la_SOURCES = \
 	demo.c
 
-demo_la_LDFLAGS = \
-	-avoid-version -module
-
 if CYGWIN
 cygwin_export_lib = -L$(top_builddir)/src -lclaws-mail
+no_undefined = -no-undefined
 else
 cygwin_export_lib = 
+no_undefined =
 endif
 
+demo_la_LDFLAGS = \
+	-avoid-version -module $(no_undefined)
+
 demo_la_LIBADD = $(cygwin_export_lib) \
 	$(GTK_LIBS) 
 INCLUDES = \
--- origsrc/claws-mail-3.5.0/src/plugins/dillo_viewer/Makefile.am	2008-06-27 02:40:24.000000000 -0500
+++ src/claws-mail-3.5.0/src/plugins/dillo_viewer/Makefile.am	2008-07-08 14:35:36.375000000 -0500
@@ -6,14 +6,17 @@
          dillo_viewer.c \
          dillo_prefs.c dillo_prefs.h
 
-dillo_viewer_la_LDFLAGS = \
-	-avoid-version -module
-
 if CYGWIN
 cygwin_export_lib = -L$(top_builddir)/src -lclaws-mail
+no_undefined = -no-undefined
 else
 cygwin_export_lib =
+no_undefined =
 endif
+
+dillo_viewer_la_LDFLAGS = \
+	-avoid-version -module $(no_undefined)
+
 dillo_viewer_la_LIBADD = $(cygwin_export_lib) \
 	$(GTK_LIBS) \
 	$(MAEMO_LIBS)
--- origsrc/claws-mail-3.5.0/src/plugins/spamassassin/Makefile.am	2008-06-27 02:40:25.000000000 -0500
+++ src/claws-mail-3.5.0/src/plugins/spamassassin/Makefile.am	2008-07-08 14:35:37.031250000 -0500
@@ -8,14 +8,17 @@
 	libspamc.c libspamc.h \
 	utils.c utils.h
 
-spamassassin_la_LDFLAGS = \
-	-avoid-version -module
-
 if CYGWIN
 cygwin_export_lib = -L$(top_builddir)/src -lclaws-mail
+no_undefined = -no-undefined
 else
 cygwin_export_lib =
+no_undefined =
 endif
+
+spamassassin_la_LDFLAGS = \
+	-avoid-version -module $(no_undefined)
+
 spamassassin_la_LIBADD = $(cygwin_export_lib) \
 	$(GTK_LIBS)	\
 	$(OPENSSL_LIBS) \
